
# ML Service - EcoTrajet Predictions

Ce service fournit des prÃ©dictions ML pour l'application EcoTrajet via FastAPI.

## ğŸ—ï¸ Architecture du Service

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ML SERVICE ARCHITECTURE                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   EcoTrajet     â”‚    â”‚   Jupyter       â”‚    â”‚   Scripts       â”‚
â”‚   Frontend      â”‚    â”‚   Notebooks     â”‚    â”‚   Training      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ React App   â”‚ â”‚    â”‚ â”‚ Data        â”‚ â”‚    â”‚ â”‚ train_      â”‚ â”‚
â”‚ â”‚             â”‚ â”‚    â”‚ â”‚ Exploration â”‚ â”‚    â”‚ â”‚ models.py   â”‚ â”‚
â”‚ â”‚ HTTP Calls  â”‚ â”‚    â”‚ â”‚             â”‚ â”‚    â”‚ â”‚             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                            â”‚
          â”‚ POST /api/v1/predict/*                     â”‚ python scripts/
          â”‚                                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FASTAPI ML SERVICE                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   api/      â”‚  â”‚   src/      â”‚  â”‚      models/        â”‚   â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚                     â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ main.py â”‚ â”‚  â”‚ â”‚predict_ â”‚ â”‚  â”‚ â”‚ velib_lstm_     â”‚ â”‚   â”‚
â”‚  â”‚ â”‚         â”‚ â”‚  â”‚ â”‚availabilityâ”‚  â”‚ â”‚ model.h5        â”‚ â”‚   â”‚
â”‚  â”‚ â”‚routes/  â”‚ â”‚  â”‚ â”‚.py      â”‚ â”‚  â”‚ â”‚                 â”‚ â”‚   â”‚
â”‚  â”‚ â”‚- health â”‚ â”‚  â”‚ â”‚         â”‚ â”‚  â”‚ â”‚ trends_prophet_ â”‚ â”‚   â”‚
â”‚  â”‚ â”‚- predictâ”‚ â”‚  â”‚ â”‚analyze_ â”‚ â”‚  â”‚ â”‚ model.pkl       â”‚ â”‚   â”‚
â”‚  â”‚ â”‚         â”‚ â”‚  â”‚ â”‚trends.pyâ”‚ â”‚  â”‚ â”‚                 â”‚ â”‚   â”‚
â”‚  â”‚ â”‚models/  â”‚ â”‚  â”‚ â”‚         â”‚ â”‚  â”‚ â”‚ carbon_rf_      â”‚ â”‚   â”‚
â”‚  â”‚ â”‚- schemasâ”‚ â”‚  â”‚ â”‚calculateâ”‚ â”‚  â”‚ â”‚ model.pkl       â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚_carbon  â”‚ â”‚  â”‚ â”‚                 â”‚ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚.py      â”‚ â”‚  â”‚ â”‚ scalers/        â”‚ â”‚   â”‚
â”‚                   â”‚ â”‚         â”‚ â”‚  â”‚ â”‚ - velib_        â”‚ â”‚   â”‚
â”‚                   â”‚ â”‚utils/   â”‚ â”‚  â”‚ â”‚   scaler_x.pkl  â”‚ â”‚   â”‚
â”‚                   â”‚ â”‚- data_  â”‚ â”‚  â”‚ â”‚ - velib_        â”‚ â”‚   â”‚
â”‚                   â”‚ â”‚  loader â”‚ â”‚  â”‚ â”‚   scaler_y.pkl  â”‚ â”‚   â”‚
â”‚                   â”‚ â”‚- preprocâ”‚ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚                   â”‚ â”‚  essing â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                           â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ HTTP Queries
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SUPABASE                               â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ velib_      â”‚  â”‚ user_trips  â”‚  â”‚ transport_modes     â”‚ â”‚
â”‚  â”‚ stations    â”‚  â”‚             â”‚  â”‚                     â”‚ â”‚
â”‚  â”‚             â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ velib_      â”‚  â”‚ â”‚distance â”‚ â”‚  â”‚ â”‚ name            â”‚ â”‚ â”‚
â”‚  â”‚ availabilityâ”‚  â”‚ â”‚co2_savedâ”‚ â”‚  â”‚ â”‚ co2_factor      â”‚ â”‚ â”‚
â”‚  â”‚ _history    â”‚  â”‚ â”‚calories â”‚ â”‚  â”‚ â”‚ per_km          â”‚ â”‚ â”‚
â”‚  â”‚             â”‚  â”‚ â”‚transportâ”‚ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚_mode_id â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚ â”‚timestampâ”‚ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                         â”‚
â”‚  â”‚ â”‚station  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚  â”‚ â”‚_id      â”‚ â”‚                                          â”‚
â”‚  â”‚ â”‚bikes    â”‚ â”‚                                          â”‚
â”‚  â”‚ â”‚docks    â”‚ â”‚                                          â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUX DE DONNÃ‰ES                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ENTRAÃNEMENT (scripts/train_models.py)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Supabase   â”‚â”€â”€â”€â–¶â”‚ Preprocessingâ”‚â”€â”€â”€â–¶â”‚   Models    â”‚
   â”‚  Raw Data   â”‚    â”‚   & Feature   â”‚    â”‚  Training   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  Engineering  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. PRÃ‰DICTION (api/routes/predictions.py)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ HTTP        â”‚â”€â”€â”€â–¶â”‚ Load Saved  â”‚â”€â”€â”€â–¶â”‚ Generate    â”‚
   â”‚ Request     â”‚    â”‚   Models    â”‚    â”‚ Predictions â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. MODÃˆLES ML
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ LSTM VÃ©lib'     â”‚  â”‚ Prophet Trends  â”‚  â”‚ Random Forest   â”‚
   â”‚                 â”‚  â”‚                 â”‚  â”‚ Carbone         â”‚
   â”‚ â€¢ PrÃ©diction    â”‚  â”‚ â€¢ Analyse       â”‚  â”‚ â€¢ Calcul        â”‚
   â”‚   disponibilitÃ© â”‚  â”‚   tendances     â”‚  â”‚   empreinte     â”‚
   â”‚   24h           â”‚  â”‚   7 jours       â”‚  â”‚   carbone       â”‚
   â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚
   â”‚ Features:       â”‚  â”‚ Features:       â”‚  â”‚ Features:       â”‚
   â”‚ - Heure         â”‚  â”‚ - Taux          â”‚  â”‚ - Distance      â”‚
   â”‚ - Jour semaine  â”‚  â”‚   occupation    â”‚  â”‚ - Mode transportâ”‚
   â”‚ - Historique    â”‚  â”‚ - SaisonnalitÃ©  â”‚  â”‚ - Historique    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Structure du projet

```
ml_service/
â”œâ”€â”€ notebooks/               # Jupyter notebooks pour le dÃ©veloppement et l'analyse
â”‚   â”œâ”€â”€ velib_analysis.ipynb
â”‚   â”œâ”€â”€ carbon_modeling.ipynb
â”‚   â””â”€â”€ data_exploration.ipynb
â”œâ”€â”€ api/                     # API FastAPI
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ predictions.py
â”‚   â”‚   â””â”€â”€ health.py
â”‚   â””â”€â”€ models/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ schemas.py
â”œâ”€â”€ src/                     # Code source des prÃ©dictions
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ predict_availability.py
â”‚   â”œâ”€â”€ analyze_trends.py
â”‚   â”œâ”€â”€ calculate_carbon.py
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ data_loader.py
â”‚       â””â”€â”€ preprocessing.py
â”œâ”€â”€ models/                  # ModÃ¨les ML sauvegardÃ©s
â”‚   â”œâ”€â”€ velib_lstm_model.pkl
â”‚   â”œâ”€â”€ trends_prophet_model.pkl
â”‚   â””â”€â”€ carbon_rf_model.pkl
â”œâ”€â”€ data/                    # DonnÃ©es temporaires et cache
â”‚   â”œâ”€â”€ raw/
â”‚   â”œâ”€â”€ processed/
â”‚   â””â”€â”€ cache/
â”œâ”€â”€ requirements.txt
â””â”€â”€ docker-compose.yml
```

## Installation

```bash
cd ml_service
pip install -r requirements.txt
```

## DÃ©marrage de l'API

```bash
uvicorn api.main:app --reload --host 0.0.0.0 --port 8000
```

## FonctionnalitÃ©s

1. **PrÃ©diction disponibilitÃ© VÃ©lib'** - LSTM pour prÃ©dire les vÃ©los disponibles par heure
2. **Analyse des tendances** - Prophet pour l'Ã©volution sur 7 jours
3. **Calcul empreinte carbone** - Random Forest pour les suggestions de trajets
